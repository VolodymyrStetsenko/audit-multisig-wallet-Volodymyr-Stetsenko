name: Slither Audit

on:
  push:
    paths:
      - "contracts/**"
      - ".github/workflows/slither.yml"
  workflow_dispatch:

jobs:
  slither:
    runs-on: ubuntu-latest
    steps:

    # 1 Checkout
    - uses: actions/checkout@v4

    # 2 Встановлюємо curl + python3-pip + Foundry + Slither
    - name: Install tools
      run: |
        sudo apt-get update
        sudo apt-get install -y curl python3-pip
        pip3 install slither-analyzer
        curl -L https://foundry.paradigm.xyz | bash
        ~/.foundry/bin/foundryup

    # 3 Створюємо каталог для звітів
    - name: Prepare output
      run: mkdir -p slither-output

    # 4 Запускаємо Slither
    - name: Run Slither
      continue-on-error: true
      run: |
        slither ./contracts/MultiSig.sol \
          --json slither-output/report.json \
          --markdown slither-output/report.md || true

    # 5 Артефакти
    - name: Upload reports
      uses: actions/upload-artifact@v4
      with:
        name: slither-report
        path: slither-output/**
